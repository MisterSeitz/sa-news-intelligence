Scraper upsert guide for news_unified_view sources
Below are the exact tables and columns your scrapers must populate so that rows appear correctly in news_unified_view and downstream filters work (dates, URLs, categories, ward_code, etc.).

Only include columns listed as “Required” or “Recommended”; others are optional unless you need their features.

1) Crime news: crime_intelligence.incidents
Required (for view and de-dup):
source_url (text, unique) — canonical URL; used to prevent duplicates
title (text)
summary (text)
published_at (date) — this is what the view selects as published_at
Strongly recommended:
severity_level (integer, default 3) — drives sentiment label in the view
ward_code (text) — enables ward-level filtering
Optional but useful:
type, crime_category, crime_subcategory, status
city, location (free text)
geom (geometry) OR latitude/longitude — we can auto-derive ward_code if you provide location
ingested_at, occurred_at, full_text, image_url (shown in view when non-empty)
tags (text[]), suspects_count, seized_items (jsonb), source_name
Upsert key: source_url (unique)
What the view reads:

id -> cast to text
title, summary
published_at (date) -> timestamptz in view
source_url
image_url (null if empty string)
severity_level -> sentiment and risk_level
ward_code
2) General AI entries: ai_intelligence.entries
Required:
id (uuid, generated by DB if omitted)
title (text)
summary (text)
category (text) — must not be 'Crime' if you want to appear in this branch
canonical_url (text) — used as source_url in view
Recommended for correct dates:
published_date (timestamp without time zone)
ingestion_ts (timestamptz, default now())
created_at (timestamp) — fallback if others missing
At least one of these three must be set for a sane published_at in the view
Optional:
sentiment_label (text) — used by view
tags (text[])
image_url (text)
data (jsonb) with image_url key as fallback
region, country
ward_code (text) — column exists; the current view sets this to NULL, but we can update the view later to pass it through
Upsert key: You should use canonical_url or a dedup_hash you maintain
What the view reads:

id (uuid->text), title, summary
published_at = coalesce(published_date, ingestion_ts, created_at)
source_url = canonical_url
image_url = data->>'image_url' fallback or image_url
category, sentiment_label as sentiment
tags
country
ward_code is currently NULL in the view
3) Election news: gov_intelligence.election_news
Required:
source_url (text, unique)
title (text)
summary (text)
published_at (timestamptz)
Recommended:
sentiment (text) — used by view
ward_codes (text[]) and municipality_codes (text[]) if geo-scoping is known
image_url (text)
Upsert key: source_url (unique)
What the view reads:

id, title, summary, published_at, source_url, image_url
category hard-coded as 'Politics'
sentiment
ward_code is NULL in the view
4) Sports news: sports_intelligence.news
Required:
url (text, unique)
title (text)
published_at (timestamp without time zone)
Recommended:
summary (text)
structured_data (jsonb) with image_url key
category (text) if you want custom categories (view sets 'Sports' static)
Upsert key: url (unique)
What the view reads:

id, title, summary, published_at, source_url = url
image_url from structured_data->>'image_url'
category hard-coded as 'Sports'
ward_code is NULL in the view
5) Motoring: ai_intelligence.motoring
Required:
url (text, unique)
title (text)
published (text) — this is cast to timestamptz in the view; ensure ISO8601 or a parseable format
Recommended:
ai_summary (summary in the view)
sentiment (text) — used by view
region_id (uuid) if you have a region
tags (text[])
country (text)
ward_code (text) — column exists; current view outputs NULL for ward_code, we can update to pass it through
Upsert key: url (unique)
What the view reads:

id (bigint->text), title, ai_summary as summary
published (text->timestamptz)
source_url = url
sentiment
region_id, tags, country
ward_code is currently NULL in the view
6) Energy: ai_intelligence.energy
Required:
url (text, unique)
title (text)
published (text) — cast to timestamptz; ensure parseable format
Recommended:
ai_summary (summary)
sentiment (text)
markets (text[]) as tags in the view
country (text)
ward_code (text) — column exists; view currently sets it NULL
Upsert key: url (unique)
What the view reads:

id (bigint->text), title, ai_summary as summary
published (text->timestamptz)
source_url = url
sentiment, tags from markets, country
ward_code NULL in the view
7) Semiconductors: ai_intelligence.semiconductors
Required:
url (text, unique)
title (text)
published (timestamptz)
Recommended:
ai_summary
region_id, tags, country
ward_code (text) — column exists; view currently sets NULL
Upsert key: url (unique)
What the view reads:

id (bigint->text), title, ai_summary, published, source_url = url
region_id, tags, country
ward_code NULL in the view
8) BRICS: ai_intelligence.brics
Required:
url (text, upsert key)
title (text)
published (text) — cast to timestamptz; ensure parseable format
Recommended:
ai_summary
sentiment (integer or text) — view doesn’t use sentiment here except to pass ‘Info’ risk_level
country (text)
ward_code (text) — column exists; view currently sets NULL
Upsert key: url (text) — or manage dedup externally
What the view reads:

id (bigint->text), title, ai_summary, published (text->timestamptz)
source_url = url
country
ward_code NULL in the view
Common upsert patterns
Use the natural-unique URL fields to avoid duplicates:

incidents.source_url
entries.canonical_url
election_news.source_url
sports.news.url
motoring.url
energy.url
semiconductors.url
brics.url
Dates

Ensure published/published_at fields are set and parseable as timestamps.
For entries, set at least one of published_date, ingestion_ts, created_at.
Ward code

If you have latitude/longitude or geometry, we can auto-derive ward_code via triggers/helper:
Provide geom (POINT) or latitude/longitude in crime_intelligence.incidents and business_intelligence.* as applicable.
For AI tables that don’t have geom, you can:
Set ward_code directly if you already know it, or
Store latitude/longitude in data/json and we add a backfill pipeline.*
Minimal payload examples (JSON upsert bodies)
crime_intelligence.incidents

Required minimum: { title, summary, source_url, published_at }
Optional: { severity_level, ward_code, image_url, city, latitude, longitude }
ai_intelligence.entries

Required minimum: { title, summary, category, canonical_url, published_date }
Optional: { sentiment_label, tags, image_url, data: { image_url }, country, ward_code }
gov_intelligence.election_news

Required minimum: { title, summary, source_url, published_at }
Optional: { sentiment, image_url, ward_codes, municipality_codes }
sports_intelligence.news

Required minimum: { title, url, published_at }
Optional: { summary, structured_data: { image_url } }
ai_intelligence.motoring

Required minimum: { title, url, published }
Optional: { ai_summary, sentiment, region_id, tags, country, ward_code }
ai_intelligence.energy

Required minimum: { title, url, published }
Optional: { ai_summary, sentiment, markets, country, ward_code }
ai_intelligence.semiconductors

Required minimum: { title, url, published }
Optional: { ai_summary, region_id, tags, country, ward_code }
ai_intelligence.brics

Required minimum: { title, url, published }
Optional: { ai_summary, sentiment, country, ward_code }
Likely causes of missing/incorrect data
published fields as non-parseable strings (e.g., “31 Jan 2026” without timezone). Use ISO8601 like “2026-01-31T20:41:49Z”.
Not setting the unique URL columns causes duplicates or failed upserts.
Putting image URLs only in non-standard keys; for entries and sports.news the view looks at data->>'image_url' or structured_data->>'image_url'.
Missing severity_level for incidents leaves all as “General” urgency.
Not populating ward_code or location fields prevents ward-level filtering.